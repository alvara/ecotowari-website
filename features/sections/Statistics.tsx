import React from 'react';
import { useRouter } from 'next/router';
import {
  totalStickers,
  waterSaved,
  electricitySaved,
  co2Saved,
  flyersReduced,
} from '../../utils/calculations';
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';
import {
  faHouseUser,
  faWater,
  faTree,
  faLightbulb,
  faCloud,
} from '@fortawesome/free-solid-svg-icons';
import useSWR from 'swr';
import { ISticker } from '../../services/type';
import axios from 'axios';
import { useCountUp } from 'react-countup';
import { StatisticCard } from '../../components/card/StatisticCard';

interface IStatistics {
  stickers: ISticker[];
}

export default function Statistics({ stickers }: IStatistics) {
  const router = useRouter();

  const { data } = useSWR(
    '/api/stickers/',
    () => {
      return axios.get('/api/stickers/').then((res) => res.data);
    },
    {
      fallbackData: stickers,
    }
  );

  //  configure countups
  useCountUp({
    ref: 'totalStickers',
    end: Math.round(totalStickers(data)),
    enableScrollSpy: true,
    scrollSpyDelay: 150,
  });

  useCountUp({
    ref: 'flyersReduced',
    end: Math.round(flyersReduced(data)),
    enableScrollSpy: true,
    scrollSpyDelay: 150,
  });

  useCountUp({
    ref: 'waterSaved',
    end: Math.round(waterSaved(data)),
    enableScrollSpy: true,
    scrollSpyDelay: 150,
  });

  useCountUp({
    ref: 'electricitySaved',
    end: Math.round(electricitySaved(data)),
    enableScrollSpy: true,
    scrollSpyDelay: 150,
  });

  useCountUp({
    ref: 'c02Saved',
    end: Math.round(co2Saved(data)),
    enableScrollSpy: true,
    scrollSpyDelay: 150,
  });

  return (
    <div id="portfolio" className="h-100 text-center justify-content-center">
      <div className="row">
        <div className="offset-md-2 col-md-8">
          <span className="preTitle">How We Help</span>
          <h2>
            {router.locale === 'en'
              ? 'ecotowari In Numbers'
              : '数字で見るecotowari'}
          </h2>
          <pre>
            {router.locale === 'en' ? (
              <>
                <p>
                  A single ecotowari sticker helps reduce waste generated by
                  brochures by 85 grammes per week on average (tests done in the
                  Tokyo region). It might not seem like much in itself but
                  imagine the impact that all the ecotowari stickers together
                  are having...
                </p>
                <p>
                  No need to imagine it! We have laid it out below in our
                  real-time impact generator ↓
                </p>
              </>
            ) : (
              <>
                <p>
                  東京都内で行った実証実験によると、ecotowariステッカー１枚あたり、一週間で平均85gのチラシの無駄遣いを減らすことができます。一枚だとそこまで大きな効果があるように感じませんが、全てのecotowariステッカーによる効果を想像してみてください。
                </p>
                <p>
                  全てのecotowariステッカーにより、どれほどの資源が守られているか見てみよう！
                </p>
              </>
            )}
          </pre>
        </div>
      </div>
      <div className="row justify-content-center align-items-center pt-4">
        <div className="col-md-4">
          <StatisticCard
            id="totalStickers"
            faIcon={faHouseUser}
            description={
              router.locale === 'en' ? 'Stickers in place' : 'ステッカー使用数'
            }
            statistic={Math.round(totalStickers(data))}
          />
        </div>
        <div className="col-md-4">
          <StatisticCard
            id="flyersReduced"
            faIcon={faTree}
            description={
              router.locale === 'en'
                ? 'Paper waste reduced'
                : '削減されたチラシ'
            }
            statistic={Math.round(flyersReduced(data))}
            unit="kg"
          />
        </div>
        <div className="col-md-4">
          <StatisticCard
            id="waterSaved"
            faIcon={faWater}
            description={
              router.locale === 'en' ? 'Water saved' : 'リットルの水を節約'
            }
            statistic={Math.round(waterSaved(data))}
            unit="L"
          />
        </div>
        <div className="col-md-4">
          <StatisticCard
            id="electricitySaved"
            faIcon={faLightbulb}
            description={
              router.locale === 'en' ? 'Water saved' : 'リットルの水を節約'
            }
            statistic={Math.round(electricitySaved(data))}
            unit="kWh"
          />
        </div>
        <div className="col-md-4">
          <StatisticCard
            id="c02Saved"
            faIcon={faCloud}
            description={router.locale === 'en' ? 'CO₂ saved' : '削減されたCO₂'}
            statistic={Math.round(co2Saved(data))}
            unit="kg-CO2e"
          />
        </div>
      </div>
    </div>
  );
}
